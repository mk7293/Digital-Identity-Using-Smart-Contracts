<html lang="en">
    <head>
        <title>Smart ID</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<link rel="stylesheet" type="text/css" href="main.css">
        <script src="./node_modules/web3/dist/web3.min.js"></script>
      </head>
<body>

<div class="container">
        <h3 class="text-center">Enter your information: </h3>

  <div class="jumbotron">

	<!-- Modal content for validating password-->
	<div class="modal fade" id="RecievedProfilePasswordTakerModal" role="dialog">
			<div class="modal-dialog modal-lg">
			  <div class="modal-content">
				<div class="modal-header">
				  <button type="button" class="close" data-dismiss="modal">&times;</button>
				</div>
				<div class="modal-body" >

						<label class="control-label col-sm-2" for="recievedProfilePwd">Private key:</label>
					<div class="col-sm-10">
						<input type="password" class="form-control" id="recievedProfilePwd" placeholder="Enter your private key to view the recieved profile" required>
					</div>
					<p class="text-info" align="center">If you want to view the received profile, only then press view</p>

				</div>
				<div class="modal-footer">
						<div class="btn-group btn-group-justified">
								<div class="btn-group">
									  <button id="recievedProfViewBtn" type="button" class="btn btn-primary" data-toggle="modal" data-target="#recievedProfileInfoModal">View Received Profile</button>
								</div>
								<div class="btn-group">
									  <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
								</div>
						</div>

				</div>
			  </div>

			</div>
		  </div>


	<!-- Modal content for received profile-->

	<div class="modal fade" id="recievedProfileInfoModal" role="dialog">
			<div class="modal-dialog">

			  <!-- Modal content-->
			  <div class="modal-content">
				<div class="modal-header">
				  <button type="button" class="close" data-dismiss="modal">&times;</button>
				  <h4 class="modal-title">Recieved Profile</h4>
				</div>
				<div class="modal-body">

				<ul class="list-group">
					<li class="list-group-item">Address: <span id="addrRecievedMod" ></span></li>
					<li class="list-group-item">Name: <span id="nameRecievedMod" ></span></li>
					<li class="list-group-item">DOB: <span id="dobRecievedMod"></span></li>
					<li class="list-group-item">Gender: <span id="genRecievedMod"></span></li>
					<li class="list-group-item">Mobile: <span id="mobRecievedMod"></span></li>
					<li class="list-group-item">Mailing: <span id="mailRecievedMod"></span></li>
					<li class="list-group-item">Email: <span id="emailRecievedMod"></span></li>
					<li class="list-group-item">Unique ID: <span id="UniqueIdRecievedMod"></span></li>
					<!--<li class="list-group-item">Unique ID: <span id="idMod"></span></li> -->
				</ul>
				</div>
				<div class="modal-footer">
				  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				</div>
			  </div>

			</div>
		  </div>

	<!-- Modal content for validating password-->
		<div class="modal fade" id="viewingInfoPassValModal" role="dialog">
				<div class="modal-dialog modal-lg">
				  <div class="modal-content">
					<div class="modal-header">
					  <button type="button" class="close" data-dismiss="modal">&times;</button>
					</div>
					<div class="modal-body" >
							<p class = "text-danger" id="ViewProfilePassValModal"></p>
							<label class="control-label col-sm-2" for="ViewingInfoValPwd">Password:</label>
						<div class="col-sm-10">
							<input type="password" class="form-control" id="ViewingInfoValPwd" placeholder="Enter the same password that you entered while saving your profile" required>
						</div>
						<p class="text-info" align="center">If you want to view your saved profile, only then press view</p>

					</div>
					<div class="modal-footer">
							<div class="btn-group btn-group-justified">
									<div class="btn-group">
									  	<button id="viewFromModalBtn" type="button" class="btn btn-primary" data-toggle="modal" data-target="#mySmartInfoModal">View Profile</button>
									</div>
									<div class="btn-group">
									  	<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
									</div>
							</div>

					</div>
				  </div>

				</div>
			  </div>

	  <!-- Modal content for viewing the information -->
	  <div class="modal fade" id="mySmartInfoModal" role="dialog">
			<div class="modal-dialog">

			  <!-- Modal content-->
			  <div class="modal-content">
				<div class="modal-header">
				  <button type="button" class="close" data-dismiss="modal">&times;</button>
				  <h4 class="modal-title">Saved Profile</h4>
				</div>
				<div class="modal-body">
					<p id="tet"></p>
				<ul class="list-group">
					<li class="list-group-item">Address: <span id="addrMod" ></span></li>
					<li class="list-group-item">Name: <span id="nameMod" ></span></li>
					<li class="list-group-item">DOB: <span id="dobMod"></span></li>
					<li class="list-group-item">Public key: <textarea class="form-control" rows="5" id="retPubKey"></textarea></li>
					<li class="list-group-item">Gender: <span id="genMod"></span></li>
					<li class="list-group-item">Mobile: <span id="mobMod"></span></li>
					<li class="list-group-item">Mailing: <span id="mailMod"></span></li>
					<li class="list-group-item">Email: <span id="emailMod"></span></li>
					<li class="list-group-item">Unique ID: <span id="UniqueIdMod"></span></li>
					<!--<li class="list-group-item">Unique ID: <span id="idMod"></span></li> -->

				</ul>
				</div>
				<div class="modal-footer">
				  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				</div>
			  </div>

			</div>
		  </div>

		  <!-- Logic for sending information-->
		  <div class="modal fade" id="sendingInfoModal" role="dialog">
				<div class="modal-dialog">

				  <!-- Modal content-->
				  <div class="modal-content">
					<div class="modal-header">
					  <button type="button" class="close" data-dismiss="modal">&times;</button>
					  <h4 class="modal-title">Select Profile Information to send</h4>
					</div>
					<div class="modal-body">
						<div class="checkbox">
						   <label class="checkbox-inline">
								<input type="checkbox" value="nameSendProf" id="specificInfoName">Name
							</label>
							<label class="checkbox-inline">
								<input type="checkbox" value="dobSendProf" id="specificInfoDob">DOB
							</label>
							<label class="checkbox-inline">
									<input type="checkbox" value="genSendProf" id="specificInfoGen">Gender
								</label>
						</div>
						<div class="checkbox">

							<label class="checkbox-inline">
								<input type="checkbox" value="mobSendProf" id="specificInfoMob">Mobile
							</label>
							<label class="checkbox-inline">
								<input type="checkbox" value="mailSendProf" id="specificInfoMail">Mailing
							</label>

							<label class="checkbox-inline">
									<input type="checkbox" value="emailSendProf" id="specificInfoEmail">Email
								</label>
						</div>
						<div class="checkbox">

							<label class="checkbox-inline">
								<input type="checkbox" value="UidSendProf" id="specificInfoId">Unique ID
							</label>
						</div>

					<div class="form-group">
							<label class="control-label" for="passTogetEncryptedData">Get Profile Password:</label>
							<input type="password" class="form-control" id="passTogetEncryptedData" placeholder="Enter the password to get the data" required>
					</div>
					<div class="form-group">
						<label class="control-label" for="passToEncryptSendingData">Password:</label>
						<input type="password" class="form-control" id="passToEncryptSendingData" placeholder="Enter a good password to encrypt your data" required>
					</div>

					<div class="form-group">
						<label for="receiverAddr">Enter the address of the recipient</label>
						<input type="text" class="form-control" id="receiverAddr">
					</div>


					</div>
					<div class="modal-footer">
					  <button id="SendProfileBtn" type="button" class="btn btn-default" >Send Information</button>
					  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				  </div>

				</div>
			  </div>


     <!-- Form for taking input for setting the profile-->
      <div class="form-horizontal">
		<div class="form-group">
				<!--<button id="sendInfo" type="button" class="btn btn-primary">Send Profile</button>-->
				<button id="receiveInfo" type="button" class="btn btn-info" data-toggle="modal" data-target="#RecievedProfilePasswordTakerModal">View Received Profile</button>
		  </div>

        <div class="form-group">
            <label class="control-label col-sm-2" for="name">Name</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="name" placeholder="Enter name" name="name">
            </div>
		</div>
		<div class="form-group">
				<label class="control-label col-sm-2" for="PublicKey">Public key</label>
			<div class="col-sm-10">
				<textarea class="form-control" rows="3" id="PublicKey" placeholder="First generate your private key using terminal commands 'openssl rsa -pubout -in rsa_1024_priv.pem -out rsa_1024_pub.pem'. Then use 'openssl rsa -pubout -in rsa_1024_priv.pem -out rsa_1024_pub.pem' for private key. Use cat 'name_of_key_file' to retrieve the keys." ></textarea>
			</div>
		</div>
        <div class="form-group">
          <label class="control-label col-sm-2" for="email">Email</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="email" placeholder="Enter email" name="email">
          </div>
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2" for="dob">DOB</label>
            <div class="col-sm-10">
              <input type="date" class="form-control" id="dob" placeholder="Enter date of birth" name="dob">
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2" for="mob">Mobile</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="mob" placeholder="Enter Mobile number" name="mob">
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2" for="ipaddr">Mailing Address</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="ipaddr" placeholder="Apartment, area, zip" name="ipaddr">
          </div>
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2" for="Uid">License</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="Uid" placeholder="Enter your unique ID" name="Uid">
          </div>
        </div>

        <div class="form-group">
          <label class="control-label col-sm-2" for="gender">Gender</label>

          <label class="radio-inline">
             <input type="radio" name="gender" value="Male" id="gen"> M
          </label>
          <label class="radio-inline">
             <input type="radio" name="gender" value="Female" id="gen"> F
          </label>
	  </div>

	  <div class="form-group">
			<label class="control-label col-sm-2" for="PwdEntry">Password:</label>
		<div class="col-sm-10">
			<input type="password" class="form-control" id="PwdEntry" placeholder="Enter a password" required>
		</div>
	 </div>

	 <div class="form-group">
			<label class="control-label col-sm-2" for="ConfirmPwd">Confirm Password:</label>
		<div class="col-sm-10">
			<input type="password" class="form-control" id="ConfirmPwd" placeholder="Confirm your password" required>
		</div>
	 </div>


        <!--<div class="form-group">
          <div class="col-sm-offset-2 col-sm-10">
            <button id="setProfileBtn" type="submit" class="btn btn-default">Submit information</button>
		  </div>-->
		  <h3 class = "text-danger" align="center" id="PasswordValidationMsg"></h3>
		  <div class="btn-group btn-group-justified">
			<div class="btn-group">
			  <button id="setProfileBtn" type="button" class="btn btn-primary">Save Profile</button>
			</div>
			<div class="btn-group">
			  <!--<button id="getProfileBtn" type="button" class="btn btn-primary">View information</button>-->
			  <button id="getProfileBtn" type="button" class="btn btn-info " data-toggle="modal" data-target="#viewingInfoPassValModal">View Profile</button>
			</div>

			<div class="btn-group">
			  <!--<button id="sendInfo" type="button" class="btn btn-primary">Send Profile</button>-->
			  <button id="sendInfo" type="button" class="btn btn-primary" data-toggle="modal" data-target="#sendingInfoModal">Send Profile</button>
			</div>
		</div>


		<span id="smartTransHash"></span>
		<img id="loader" src = "https://loading.io/spinners/double-ring/lg.double-ring-spineer.gif">

		</div>
      </div>

  </div>

</div>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="./node_modules/crypto-js/crypto-js.js"></script>
<script src="./node_modules/jsencrypt/bin/jsencrypt.min.js"> </script>

<!-- web3 scripting starts here -->

<script>
if (typeof web3 !== 'undefined') {
  web3 = new Web3(web3.currentProvider);
} else {
  web3 = new Web3(new Web3.providers.HttpProvider('http://localhost:8545'));
}

web3.eth.defaultAccount = web3.eth.accounts[0];

var smartIDContract = web3.eth.contract([
  {
    anonymous: false,
    inputs: [
      {
        indexed: false,
        name: 'profile_owner_Address',
        type: 'address'
      },
      {
        indexed: false,
        name: 'fullName',
        type: 'bytes32'
      },
      {
        indexed: false,
        name: 'dob',
        type: 'bytes16'
      },
      {
        indexed: false,
        name: 'gender',
        type: 'bytes16'
      },
      {
        indexed: false,
        name: 'mobileNo',
        type: 'bytes32'
      },
      {
        indexed: false,
        name: 'mailingAddress',
        type: 'bytes32'
      },
      {
        indexed: false,
        name: 'emailId',
        type: 'bytes32'
      }
    ],
    name: 'ProfileGetting',
    type: 'event'
  },
  {
    anonymous: false,
    inputs: [
      {
        indexed: false,
        name: 'profile_owner_Address',
        type: 'address'
      },
      {
        indexed: false,
        name: 'fullName',
        type: 'bytes32'
      },
      {
        indexed: false,
        name: 'dob',
        type: 'bytes16'
      },
      {
        indexed: false,
        name: 'gender',
        type: 'bytes16'
      },
      {
        indexed: false,
        name: 'mobileNo',
        type: 'string'
      },
      {
        indexed: false,
        name: 'mailingAddress',
        type: 'string'
      },
      {
        indexed: false,
        name: 'emailId',
        type: 'bytes32'
      },
      {
        indexed: false,
        name: 'Uid',
        type: 'string'
      }
    ],
    name: 'ProfileSetting',
    type: 'event'
  },
  {
    anonymous: false,
    inputs: [
      {
        indexed: true,
        name: 'sender',
        type: 'address'
      },
      {
        indexed: false,
        name: 'notificationMsg',
        type: 'bytes32'
      }
    ],
    name: 'ChangeNotification',
    type: 'event'
  },
  {
    constant: false,
    inputs: [
      {
        name: '_to',
        type: 'address'
      },
      {
        name: '_name',
        type: 'bytes32'
      },
      {
        name: '_dob',
        type: 'bytes16'
      },
      {
        name: '_gender',
        type: 'bytes16'
      },
      {
        name: '_mobile',
        type: 'string'
      },
      {
        name: '_mailing',
        type: 'string'
      },
      {
        name: '_email',
        type: 'bytes32'
      },
      {
        name: '_Uid',
        type: 'string'
      },
      {
        name: '_passKey',
        type: 'string'
      }
    ],
    name: 'sendProfile',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function'
  },
  {
    constant: false,
    inputs: [
      {
        name: '_name',
        type: 'bytes32'
      },
      {
        name: '_dob',
        type: 'bytes16'
      },
      {
        name: '_gender',
        type: 'bytes16'
      },
      {
        name: '_mobile',
        type: 'string'
      },
      {
        name: '_mailing',
        type: 'string'
      },
      {
        name: '_email',
        type: 'bytes32'
      },
      {
        name: '_Uid',
        type: 'string'
      },
      {
        name: '_publicKey',
        type: 'string'
      }
    ],
    name: 'setProfile',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function'
  },
  {
    constant: true,
    inputs: [
      {
        name: '',
        type: 'address'
      }
    ],
    name: 'addrPublicKeymapping',
    outputs: [
      {
        name: '',
        type: 'string'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function'
  },
  {
    constant: true,
    inputs: [],
    name: 'getProfile',
    outputs: [
      {
        name: '',
        type: 'address'
      },
      {
        name: '',
        type: 'bytes32'
      },
      {
        name: '',
        type: 'bytes16'
      },
      {
        name: '',
        type: 'bytes16'
      },
      {
        name: '',
        type: 'string'
      },
      {
        name: '',
        type: 'string'
      },
      {
        name: '',
        type: 'bytes32'
      },
      {
        name: '',
        type: 'string'
      },
      {
        name: '',
        type: 'string'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function'
  },
  {
    constant: true,
    inputs: [
      {
        name: 'accountAddress',
        type: 'address'
      }
    ],
    name: 'getPublicKey',
    outputs: [
      {
        name: '',
        type: 'string'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function'
  },
  {
    constant: true,
    inputs: [
      {
        name: '',
        type: 'address'
      }
    ],
    name: 'lastProfileIndex',
    outputs: [
      {
        name: '',
        type: 'uint256'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function'
  },
  {
    constant: true,
    inputs: [
      {
        name: '',
        type: 'address'
      }
    ],
    name: 'profiles',
    outputs: [
      {
        name: 'profile_owner_Address',
        type: 'address'
      },
      {
        name: 'fullName',
        type: 'bytes32'
      },
      {
        name: 'dob',
        type: 'bytes16'
      },
      {
        name: 'gender',
        type: 'bytes16'
      },
      {
        name: 'mobileNo',
        type: 'string'
      },
      {
        name: 'mailingAddress',
        type: 'string'
      },
      {
        name: 'emailId',
        type: 'bytes32'
      },
      {
        name: 'Uid',
        type: 'string'
      },
      {
        name: 'passkey',
        type: 'string'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function'
  },
  {
    constant: true,
    inputs: [],
    name: 'readReceivedProfile',
    outputs: [
      {
        name: '',
        type: 'address'
      },
      {
        name: '',
        type: 'bytes32'
      },
      {
        name: '',
        type: 'bytes16'
      },
      {
        name: '',
        type: 'bytes32'
      },
      {
        name: '',
        type: 'string'
      },
      {
        name: '',
        type: 'string'
      },
      {
        name: '',
        type: 'bytes32'
      },
      {
        name: '',
        type: 'string'
      },
      {
        name: '',
        type: 'string'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function'
  },
  {
    constant: true,
    inputs: [
      {
        name: '',
        type: 'address'
      },
      {
        name: '',
        type: 'uint256'
      }
    ],
    name: 'receivedProfile',
    outputs: [
      {
        name: 'profile_owner_Address',
        type: 'address'
      },
      {
        name: 'fullName',
        type: 'bytes32'
      },
      {
        name: 'dob',
        type: 'bytes16'
      },
      {
        name: 'gender',
        type: 'bytes16'
      },
      {
        name: 'mobileNo',
        type: 'string'
      },
      {
        name: 'mailingAddress',
        type: 'string'
      },
      {
        name: 'emailId',
        type: 'bytes32'
      },
      {
        name: 'Uid',
        type: 'string'
      },
      {
        name: 'passkey',
        type: 'string'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function'
  }
]);

var smartID = smartIDContract.at('0xf517a73a8c16b400dc090eab2c2301a1e089a1b9'); //Address where the contract is stored in the blockchain
//console.log(smartID);

var settingProfileEvent = smartID.ProfileSetting({}, 'latest'); //Event for setting profile

var gettingProfileEvent = smartID.ProfileGetting({}, 'latest'); //Event for getting profile

//Watching the setting event
settingProfileEvent.watch(function(error, result) {
  if (!error) {
    //console.log("Inside event");
    if (result.blockHash != $('#smartTransHash').html()) $('#loader').hide();
    $('#smartTransHash').html('Block hash: ' + result.blockHash);
    //$("#name").html(web3.toAscii(result.args.fullName) + ' ' + web3.toAscii(result.args.dob) + '  ' + result.args.mobileNo);
  } else {
    $('#loader').hide();
    console.log(error);
    //console.log("Inside event but error");
  }
});

//Watching the getting event
gettingProfileEvent.watch(function(error, result) {
  console.log('Atleast inside event');
  if (!error) {
    console.log('Inside Getting event');
    $('#loader').hide();
    $('#addr').html(web3.toAscii(result.args.fullName));
  } else {
    $('#loader').hide();
    console.log(error);
    //console.log("Inside event but error");
  }
});

// Receiving Profile info
// Sending the profile information
$('#recievedProfViewBtn').click(function() {
  console.log('hello from button recieved');

  var recipientAddress = $('#receiverAddr').val();
  var privateKeyOfReciever = $('#recievedProfilePwd').val(); // private key of reciever
  var mobDecryptedValForReciever = '';
  var mailDecryptedValForReciever = '';
  var idDecryptedValForReciever = '';
  var passKeyDecrypted = '';

  console.log('hello from button recieved1');

  smartID.readReceivedProfile((err, result) => {
    if (err) {
      console.log(error);
      console.log('hello from button recieved2');
    } else {
      console.log('hello from button recieved3');
      console.log(result[8]);
      passKeyDecrypted = assymetricRSADecryption(
        result[8],
        privateKeyOfReciever
      );

      console.log('hello from button recieved4' + result[8]);

      var decForGoingAhead = typeof passKeyDecrypted;
      console.log(passKeyDecrypted);
      if (decForGoingAhead != false) {
        mobDecryptedValForReciever = symmetricDecryption(
          result[4],
          passKeyDecrypted
        );
        console.log(mobDecryptedValForReciever);
        console.log('hello from button recieved5');
        mailDecryptedValForReciever = symmetricDecryption(
          result[5],
          passKeyDecrypted
        );
        console.log(mailDecryptedValForReciever);
        idDecryptedValForReciever = symmetricDecryption(
          result[7],
          passKeyDecrypted
        );
        console.log(idDecryptedValForReciever);

        console.log('hello from button recieved5');
        console.log('hello ' + mobDecryptedValForReciever);
        $('#addrRecievedMod').html(result[0]);
        $('#nameRecievedMod').html(web3.toAscii(result[1]));
        $('#dobRecievedMod').html(web3.toAscii(result[2]));
        $('#genRecievedMod').html(web3.toAscii(result[3]));
        $('#mobRecievedMod').html(mobDecryptedValForReciever);
        $('#mailRecievedMod').html(mailDecryptedValForReciever);
        $('#emailRecievedMod').html(web3.toAscii(result[6]));
        $('#UniqueIdRecievedMod').html(idDecryptedValForReciever);
      }
    }
  });

  //$('#loader').show();
});

// Sending the profile information
$('#SendProfileBtn').click(function() {
  console.log('hello from button sender');

  var recipientAddress = $('#receiverAddr').val();
  var passKeyToGetEncryptedData = $('#passTogetEncryptedData').val();

  /* This Passkey will be used to encrypt the sending data and then be encrypted using receiver's public key
	. So that the passkey remains secure. In the reciever's side the reciever will first decrypt the passkey using
	his private key and then use the decrypted passkey to decrypt the data recieved.
	*/
  var passKeyToEncryptSendingData = $('#passToEncryptSendingData').val();
  var passKeyEncryptedUsingRecieversPubKey = ''; //encrypted the passkey using reciever's pub. key
  var mobDecryptedForSendining = '';
  var mailDecryptedForSendining = '';
  var idDecryptedForSendining = '';

  var nameSending = '';
  var dobSending = '';
  var genSending = '';
  var emailSending = '';
  var mobSending = '';
  var mailSending = '';
  var idSending = '';

  //getting the reciver's public key
  var RecieversPubKey;

  smartID.getPublicKey(recipientAddress, (err, res) => {
    if (err) {
      console.log(error);
    } else {
      RecieversPubKey = res;
      console.log(res);
    }
  });

  smartID.getProfile((err, result) => {
    if (err) {
      console.log(error);
    } else {
      mobDecryptedForSendining = symmetricDecryption(
        result[4],
        passKeyToGetEncryptedData
      );
      mailDecryptedForSendining = symmetricDecryption(
        result[5],
        passKeyToGetEncryptedData
      );
      idDecryptedForSendining = symmetricDecryption(
        result[7],
        passKeyToGetEncryptedData
      );

      var nameDecToSend = $('#specificInfoName').is(':checked');
      var DobDecToSend = $('#specificInfoDob').is(':checked');
      var GenDecToSend = $('#specificInfoGen').is(':checked');
      var MobDecToSend = $('#specificInfoMob').is(':checked');
      var MailDecToSend = $('#specificInfoMail').is(':checked');
      var EmailDecToSend = $('#specificInfoEmail').is(':checked');
      var IdDecToSend = $('#specificInfoId').is(':checked');

      if (nameDecToSend) {
        nameSending = web3.toAscii(result[1]);
      }
      if (DobDecToSend) {
        dobSending = web3.toAscii(result[2]);
      }
      if (GenDecToSend) {
        genSending = web3.toAscii(result[3]);
      }
      if (MobDecToSend) {
        mobSending = symmetricEncryption(
          mobDecryptedForSendining,
          passKeyToEncryptSendingData
        );
      }
      if (MailDecToSend) {
        mailSending = symmetricEncryption(
          mailDecryptedForSendining,
          passKeyToEncryptSendingData
        );
      }
      if (EmailDecToSend) {
        emailSending = web3.toAscii(result[6]);
      }
      if (IdDecToSend) {
        idSending = symmetricEncryption(
          idDecryptedForSendining,
          passKeyToEncryptSendingData
        );
      }

      console.log(RecieversPubKey);
      console.log(passKeyEncryptedUsingRecieversPubKey);

      passKeyEncryptedUsingRecieversPubKey = assymetricRSAEncryption(
        passKeyToEncryptSendingData,
        RecieversPubKey
      );

      console.log(RecieversPubKey);
      console.log(passKeyEncryptedUsingRecieversPubKey);

      smartID.sendProfile(
        recipientAddress,
        nameSending,
        dobSending,
        genSending,
        mobSending,
        mailSending,
        emailSending,
        idSending,
        passKeyEncryptedUsingRecieversPubKey,
        (err, result) => {
          if (err) {
            console.log('inside sending error');

            console.log(error);
          } else {
            console.log(passKeyEncryptedUsingRecieversPubKey);
          }
        }
      );
    }
  });
  console.log('Sending is done');

  //$('#loader').show();
});

// Getting the profile information
$('#viewFromModalBtn').click(function() {
  console.log('hello from button getter');
  console.log($('#ViewingInfoValPwd').val());

  var passwordForDecrypting = $('#ViewingInfoValPwd').val();
  // Encrypting Function call over here and return values will be passed to setProfile
  smartID.getProfile((err, result) => {
    if (err) {
      console.log(error);
      $('#loader').hide();
    } else {
      var viewDecryptPass = $('#ViewingInfoValPwd').val();
      var mobDecrypted = symmetricDecryption(result[4], viewDecryptPass);
      var mailDecrypted = symmetricDecryption(result[5], viewDecryptPass);
      var idDecrypted = symmetricDecryption(result[7], viewDecryptPass);

      $('#addrMod').html(result[0]);
      $('#nameMod').html(web3.toAscii(result[1]));
      $('#dobMod').html(web3.toAscii(result[2]));
      $('#genMod').html(web3.toAscii(result[3]));
      $('#mobMod').html(mobDecrypted);
      $('#mailMod').html(mailDecrypted);
      $('#emailMod').html(web3.toAscii(result[6]));
      $('#UniqueIdMod').html(idDecrypted);
      $('#retPubKey').html(result[8]);
    }
  });
  //$('#loader').show();
});

$('#setProfileBtn').click(function() {
  console.log('hello from button setter');
  var password = $('#PwdEntry').val();
  var confirm_password = $('#ConfirmPwd').val();

  if (password != confirm_password) {
    $('#PasswordValidationMsg').html('Passwords do not match!');
  } else {
    // Encrypting Function call over here and return values will be passed to setProfile
    //Encrypting imp. info.
    var MobNoEncrypted = symmetricEncryption($('#mob').val(), password);
    var mailEncrypted = symmetricEncryption($('#ipaddr').val(), password);
    var uidEncrypted = symmetricEncryption($('#Uid').val(), password);

    smartID.setProfile(
      $('#name').val(),
      $('#dob').val(),
      $('input[name=gender]:checked').val(),
      MobNoEncrypted,
      mailEncrypted,
      $('#email').val(),
      uidEncrypted,
      $('#PublicKey').val(),
      (err, res) => {
        if (err) {
          console.log(error);
          $('#loader').hide();
          $('#PasswordValidationMsg').hide();
        }
        $('#loader').show();
        $('#PasswordValidationMsg').hide();
      }
    );
  }
});

/*
    Symmetric Encryption function
    We use AES(Advanced Encryption Standard) encryption to encrypt the data.
    @parameters : data to be ecrypted, key to decrypt
    @return : string of encrypted data
*/
function symmetricEncryption(data, key) {
  var encryptedData = CryptoJS.AES.encrypt(data, key);
  var encryptedDataString = encryptedData.toString();
  return encryptedDataString;
}

/*
    Symmetric Decryption function
    We use AES(Advanced Encryption Standard) decryption to decrypt the data.
    @parameters : encrypted data to be decrypted, key to decrypt
    @return : plain text of decrypted data
*/
function symmetricDecryption(data, key) {
  var decryptedData = CryptoJS.AES.decrypt(data, key);
  var decryptedDataString = decryptedData.toString(CryptoJS.enc.Utf8);
  return decryptedDataString;
}

/*
    RSA assymetric encryption function
    @parameters : encrypted data to be decrypted, key to decrypt
    @return : string of encrypted data
*/
function assymetricRSAEncryption(data, publicKey) {
  var encrypt = new JSEncrypt();
  encrypt.setPublicKey(publicKey);
  var RSAencryptedData = encrypt.encrypt(data);
  return RSAencryptedData;
}

/*
    RSA assymmetric decryption function
    @parameters : encrypted data to be decrypted, key to decrypt
    @return : plain text of decrypted data
*/
function assymetricRSADecryption(encrypted, privateKey) {
  var decrypt = new JSEncrypt();
  decrypt.setPrivateKey(privateKey);
  var RSAdecryptedData = decrypt.decrypt(encrypted);
  return RSAdecryptedData;
}
</script>

</body>
</html>
